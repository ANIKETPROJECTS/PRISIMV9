# Project Codebase Files & Logical Explanation

This document provides a comprehensive breakdown of the project's files, explaining their purpose and the logical flow of the code within them.

## Root Directory

### `Doc_01_Architecture.txt` to `Doc_07_Technical.txt` & `Documentation.txt`
- **Purpose**: These are internal documentation files that describe the system's vision, architecture, installation procedures, operational workflows, and technical specifications.
- **Logic**: They serve as a comprehensive manual for developers and administrators, detail the "Single Source of Truth" philosophy, RBAC security, and the lifecycle of data records like Bookings and Chalans.

### `drizzle.config.ts`
- **Purpose**: Configuration for Drizzle Kit (the database migration/sync tool).
- **Logic**: It specifies where the database schema is located (`shared/schema.ts`), the dialect used (PostgreSQL), and the connection credentials (via `DATABASE_URL`). It manages how changes in code are pushed to the live database.

### `vite.config.ts`
- **Purpose**: Configuration for the Vite build tool and development server.
- **Logic**:
  - **Plugins**: Integrates React, error overlays, and Replit-specific development tools.
  - **Aliases**: Defines shortcuts like `@` for `client/src` and `@shared` for the shared folder, simplifying imports.
  - **Build**: Configures the output directory for the compiled frontend assets.

### `package.json`
- **Purpose**: The project's manifest file.
- **Logic**: Defines metadata, scripts (dev, build, start), and all dependencies (frontend and backend libraries).

### `tailwind.config.ts` & `postcss.config.js`
- **Purpose**: Configuration for Tailwind CSS and PostCSS.
- **Logic**: Defines the design tokens (colors, animations) and processing rules for the application's styling system.

---

## Shared Resources

### `shared/schema.ts`
- **Purpose**: The "Single Source of Truth" for the entire application's data model.
- **Logic**:
  - **Enums**: Defines standardized types for roles (admin, gst, etc.), project types (movie, ad, etc.), and booking statuses (confirmed, cancelled).
  - **Tables**: Defines the structure for `users`, `customers`, `projects`, `rooms`, `editors`, `bookings`, and `chalans` using Drizzle ORM.
  - **Relations**: Specifies how tables link together (e.g., a Booking belongs to a Room and an Editor).
  - **Validation**: Uses `drizzle-zod` to automatically generate Zod schemas for validating data on both the frontend and backend.

---

## Backend Infrastructure (`/server`)

### `server/db.ts`
- **Purpose**: Initializes the database connection.
- **Logic**: Uses `@neondatabase/serverless` (or standard `pg`) to create a connection pool to the PostgreSQL database using the `DATABASE_URL`.

### `server/storage.ts`
- **Purpose**: The Data Access Object (DAO) layer.
- **Logic**:
  - **Interface**: Defines `IStorage` with methods for every database operation (CRUD).
  - **Conflict Logic**: Contains the `checkBookingConflicts` method which runs complex SQL queries to ensure rooms and editors aren't double-booked.
  - **Session Management**: Implements `sessionStore` to persist user logins in the database.

### `server/routes.ts`
- **Purpose**: Defines the RESTful API endpoints.
- **Logic**:
  - **Auth**: Handles login/logout and session retrieval.
  - **CRUD**: Provides endpoints for managing Customers, Projects, Rooms, and Editors.
  - **Operations**: Handles the creation and modification of Bookings and Chalans.
  - **Middleware**: Uses authentication and permission guards to protect routes based on user roles.

---

## Frontend Application (`/client`)

### `client/src/main.tsx`
- **Purpose**: The entry point for the React application.
- **Logic**: Renders the root `App` component into the `index.html` DOM element.

### `client/src/App.tsx`
- **Purpose**: The root component and router.
- **Logic**:
  - **Routing**: Uses `wouter` to define URL paths and their corresponding page components.
  - **Providers**: Wraps the application in `QueryClientProvider` (data fetching), `AuthContext` (security), and `ThemeProvider` (styling).
  - **Layout**: Sets up the global sidebar and header structure.

### `client/src/lib/auth-context.tsx`
- **Purpose**: Global authentication state.
- **Logic**: Uses React Context to store the currently logged-in user's data and provides a `useAuth` hook for components to check login status and permissions.

### `client/src/components/`
- **`app-sidebar.tsx`**: Logic for navigating between modules based on user permissions.
- **`booking-form.tsx`**: A complex form that interacts with the backend to create bookings, including real-time conflict checking as the user types.
- **`data-table.tsx`**: A generic component for displaying lists of data with sorting and filtering capabilities.

### `client/src/pages/`
- **`booking.tsx`**: The main operations dashboard showing the calendar and booking management.
- **`login.tsx`**: The entry screen for users to authenticate using their PIN.
- **`masters/`**: Contains sub-pages for managing the foundational lists (Customers, Editors, etc.).
