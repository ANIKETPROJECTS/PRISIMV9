# Project Codebase Files & Logical Explanation

This document provides a comprehensive breakdown of the project's files, explaining their purpose and the logical flow of the code within them.

## Root Directory

### `Doc_01_Architecture.txt`
- **Logical Flow**: Introduction to PRISM architecture, detailing the 3-tier decoupling strategy (React, Express, PostgreSQL) and the "Single Source of Truth" philosophy.

### `Doc_02_Installation.txt`
- **Logical Flow**: Practical guide for setting up the environment, database configuration, and production deployment steps using Node.js and PM2.

### `Doc_03_Operations.txt`
- **Logical Flow**: Deep dive into the booking lifecycle, conflict detection engine, and billing workflows (Chalans).

### `Doc_04_Masters.txt`
- **Logical Flow**: Explains the data governance for static entities like Customers, Projects, Rooms, and Editors.

### `Doc_05_Security.txt`
- **Logical Flow**: Details the security architecture, including PIN-based access and Role-Based Access Control (RBAC).

### `Doc_06_Reports.txt`
- **Logical Flow**: Overview of the analytical layer, covering utilization metrics and conflict audits.

### `Doc_07_Technical.txt`
- **Logical Flow**: Technical reference for developers, including API contracts and database schema details.

### `Documentation.txt`
- **Logical Flow**: A consolidated technical manual providing a comprehensive overview of the entire system.

### `drizzle.config.ts`
- **Logical Flow**: Configuration for Drizzle Kit. It bridges the TypeScript schema and the PostgreSQL database for synchronization.

### `vite.config.ts`
- **Logical Flow**: Build configuration. Defines path aliases (`@`, `@shared`) and plugins for React and error handling.

### `package.json`
- **Logical Flow**: Lists project dependencies and scripts. Essential for running development and production environments.

### `replit.md`
- **Logical Flow**: Project documentation and structure for the Replit environment.

---

## Shared Resources

### `shared/schema.ts`
- **Logical Flow**: The master schema. It defines database tables and uses Drizzle-Zod to create validation schemas shared between the frontend (forms) and backend (API requests).

---

## Backend Infrastructure (`/server`)

### `server/db.ts`
- **Logical Flow**: Establishes the database connection pool. It uses the `DATABASE_URL` environment variable to connect to PostgreSQL.

### `server/index.ts`
- **Logical Flow**: Entry point of the backend. Sets up the Express server, logging, session management (persisted in DB), and registers the API routes.

### `server/routes.ts`
- **Logical Flow**: Defines all API endpoints.
  - **Auth**: `POST /api/auth/login` validates PIN and creates session.
  - **Middleware**: `authMiddleware` and `requirePermission` enforce security before any logic runs.
  - **Operations**: Routes for Bookings, Chalans, and Reports interact with the storage layer.

### `server/storage.ts`
- **Logical Flow**: Implementation of `IStorage`. This is where all database queries happen.
  - **Conflict Engine**: The `checkBookingConflicts` method uses SQL logic to detect overlapping time slots for rooms and editors.
  - **Transactional CRUD**: Manages data persistence with high integrity.

---

## Frontend Application (`/client`)

### `client/src/App.tsx`
- **Logical Flow**: The root React component.
  - **Routing**: Uses `wouter` to map URLs to pages (e.g., `/` to `BookingPage`).
  - **Security**: `ProtectedRoute` checks the `useAuth` context to redirect unauthorized users to `/login`.
  - **Global Context**: Wraps the app in TanStack Query and Theme providers.

### `client/src/main.tsx`
- **Logical Flow**: Frontend entry point. Mounts the `App` component to the HTML template.

### `client/src/index.css`
- **Logical Flow**: Global styles and Tailwind configuration. Defines the color system and interaction utilities (`hover-elevate`).

### `client/src/lib/auth-context.tsx`
- **Logical Flow**: Context provider for authentication. It fetches the current session from `/api/auth/session` and makes it available to the entire app via the `useAuth` hook.

### `client/src/lib/queryClient.ts`
- **Logical Flow**: Configures `QueryClient` for TanStack Query, setting up default fetchers and caching rules for API interactions.

### `client/src/pages/`
- **`booking.tsx`**: Main operations page. It fetches bookings and renders the interactive calendar view.
- **`login.tsx`**: PIN-based login screen.

---

## Project File List (Full Inventory)

## Root Directory
- Doc_01_Architecture.txt
- Doc_02_Installation.txt
- Doc_03_Operations.txt
- Doc_04_Masters.txt
- Doc_05_Security.txt
- Doc_06_Reports.txt
- Doc_07_Technical.txt
- Documentation.txt
- components.json
- design_guidelines.md
- drizzle.config.ts
- package-lock.json
- package.json
- postcss.config.js
- replit.md
- tailwind.config.ts
- tsconfig.json
- vite.config.ts
- codebase.txt

## client/
- index.html

## client/public/
- favicon.png

## client/src/
- App.tsx
- index.css
- main.tsx

## client/src/components/
- app-sidebar.tsx
- booking-card.tsx
- booking-form.tsx
- chalan-invoice.tsx
- data-table.tsx
- empty-state.tsx
- header.tsx
- permission-guard.tsx
- sync-button.tsx
- theme-toggle.tsx
- user-profile-modal.tsx

## client/src/components/ui/
- accordion.tsx
- alert-dialog.tsx
- alert.tsx
- aspect-ratio.tsx
- avatar.tsx
- badge.tsx
- breadcrumb.tsx
- button.tsx
- calendar.tsx
- card.tsx
- carousel.tsx
- chart.tsx
- checkbox.tsx
- collapsible.tsx
- command.tsx
- context-menu.tsx
- dialog.tsx
- drawer.tsx
- dropdown-menu.tsx
- form.tsx
- hover-card.tsx
- input-otp.tsx
- input.tsx
- label.tsx
- menubar.tsx
- navigation-menu.tsx
- pagination.tsx
- popover.tsx
- progress.tsx
- radio-group.tsx
- resizable.tsx
- scroll-area.tsx
- select.tsx
- separator.tsx
- sheet.tsx
- sidebar.tsx
- skeleton.tsx
- slider.tsx
- switch.tsx
- table.tsx
- tabs.tsx
- textarea.tsx
- toast.tsx
- toaster.tsx
- toggle-group.tsx
- toggle.tsx
- tooltip.tsx

## client/src/hooks/
- use-mobile.tsx
- use-toast.ts

## client/src/lib/
- auth-context.tsx
- export-utils.ts
- messages.ts
- permissions.ts
- queryClient.ts
- theme-provider.tsx
- utils.ts

## client/src/pages/
- booking.tsx
- calendar-day-view.tsx
- history.tsx
- leaves.tsx
- login.tsx
- not-found.tsx

## client/src/pages/chalan/
- index.tsx
- revise.tsx

## client/src/pages/masters/
- customers.tsx
- editors.tsx
- projects.tsx
- rooms.tsx

## client/src/pages/reports/
- booking.tsx
- chalan.tsx
- conflict.tsx
- editor.tsx

## client/src/pages/utility/
- user-rights.tsx
- users.tsx

## docs/
- PROJECT_DOCUMENTATION.md

## script/
- build.ts

## server/
- db.ts
- index.ts
- routes.ts
- seed-demo.ts
- seed.ts
- static.ts
- storage.ts
- vite.ts

## shared/
- schema.ts
